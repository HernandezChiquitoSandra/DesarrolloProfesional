@page "/crear/pelicula"

@using AppBlazor.Client.Repositorios;
@inject IRepositorio repositorio
@inject NavigationManager navigationManager

<h3>CrearPelicula</h3>
@if (MostrarFormulario)
{
    <FormularioPelicula Pelicula="Pelicula" OnValidSubmit="Crear" GenerosNoSeleccionados="GenerosNoSeleccionados"></FormularioPelicula>

}
else
{
    <p>Cargando...</p>
}


@code {
    private Pelicula Pelicula = new Pelicula();

    private List<Genero> GenerosNoSeleccionados = new List<Genero>();

    public bool MostrarFormulario { get; set; } = false;

    protected async override Task OnInitializedAsync() //se trae los datos y luego los pasa a no seleccionados
    {
        var respuestaHTTP = await repositorio.Get<List<Genero>>("api/generos");
        GenerosNoSeleccionados = respuestaHTTP.Response!;
        MostrarFormulario = true;
    }

    private async Task Crear()
    {
        var httResponse = await repositorio.Post<Pelicula, int>("api/peliculas", Pelicula);

        if (httResponse.Error)
        {
            var mensajeError = await httResponse.ObtenerMensajeError();
            Console.WriteLine("Error xd", mensajeError);
        }
        else
        {
            Console.WriteLine("Creando Peli");
            var peliculaId = httResponse.Response;
            navigationManager.NavigateTo($"/pelicula/{peliculaId}/{Pelicula.Titulo.Replace(" ", "-")}");
        }
        
    }
}
